# atol-bpa-download

Downloads long-read (PacBio HiFi, Oxford Nanopore) and short-read (Hi-C) data files from BPA data portal for AToL's Genome Engine.

## Installation

To install the latest version on Pawsey:

```
module load nextflow/25.04.6
nextflow pull amytims/atol-bpa-download -r dev
```

## Usage

### Download read files in a config.yaml file outputted by a query to AToL's data mapper

In this case, we'd be downloading pacbio and hic data files:

```
nextflow run amytims/atol-bpa-download \
    -r dev \
    --yaml <PATH/TO/CONFIG.YAML> \
    --outdir <OUTPUT_DIRECTORY> \
    --bpa_api_token ${CKAN_API_TOKEN} \
    --pacbio_data --hic_data \
    --dry_run false
```

### Full Usage
```
options:
    --help
            Show this help message and exit

    --dry_run
            If set, a list of the samples that would be downloaded will be returned,
            and files will not actually be downloaded.
            Set this to avoid accidentally downloading Glacier files.
            Default is 'true'  ## set to false after testing is complete ##

    --pacbio_data
            Does the sample_id have PacBio HiFi data files to download, or not?
            Default is 'false'

    --hic_data
            Does the sample_id have HiC data files to download, or not?
            Default is 'false'

    --ont_data
            Does the sample_id have Oxford Nanopore data files to download, or not?
            Default is 'false'

input:
    --yaml <PATH/TO/YAML/FILE>
            Path to the .yaml file generated by the data mapper query

    --bpa_api_token BPA_API_TOKEN
            API token for BioPlatforms Australia, enables downloading of datasets
            that may not be publically accessible. Token can be created by logging 
            into https://data.bioplatforms.com/, then going to
            https://data.bioplatforms.com/user/<username>/api-tokens, and clicking 
            'Create API Token'. 

output:
    --outdir <PATH/TO/OUTPUT/DIRECTORY>
            File path to where downloaded files should be stored
            Default is './results'

            Each file type will automatically be given its own subdirectory inside 
            this one, e.g.:
                pacbio reads:   './results/hifi/'
                nanopore reads: './results/ont/'
                hi-c reads:     './results/hic/'
```

## To-do:
1. Figure out what config formatting will be for Oxford Nanopore data; update pipeline to download ONT reads 
2. Set `--dry_run` default to 'false' after testing is finished
3. Consider deprecating `--pacbio_data`, `--hic_data` and `--ont_data` options, or setting them to 'true' by default. This way, all files in the config file are downloaded by default and specific ones can be downloaded again if somethign goes wrong by toggling other file types to 'false'